# Самостоятельная работа 8–10 — Расписание занятий
##### Национальный исследовательский университет «Высшая школа экономики»

Выбранная структура данных: 

## Возможности и соответствие заданию
- Ввод записей с клавиатуры или из текстового файла; данные хранятся в порядке ввода, без сортировки.
- Вывод в консоль и сохранение в файл в порядке ввода; Запись в файл либо создаёт новый, либо дописывает в конец существующего.
- Индексация по выбранному пользователем полю: название, преподаватель, дата+время, аудитория, тип, приоритет. Строковые поля индексируются самобалансирующимся деревом (AVL), числовые — отсортированными массивами; логически удалённые записи не попадают в индексы.
- Сортированный вывод по индексу (возрастание/убывание) и поиск по индексу с возвратом всех совпадений. Для дерева реализованы и рекурсивный, и итерационный варианты обхода/поиска.
- Редактирование записей (включая ключевые поля), логическое удаление, восстановление, физическое удаление помеченных; после любых изменений индекс текущего поля перестраивается.
- Допуски из файла: загружает до `MAX_LESSONS`, лишние строки отбрасываются; некорректные даты/время/типы/приоритеты пропускаются с сообщениями.

## Структура данных
```cpp
struct Lesson {
    std::string title;      // название
    std::string teacher;    // преподаватель
    std::string date;       // DD.MM.YYYY
    std::string time;       // HH:MM
    std::string room;       // аудитория
    LessonType type;        // Lecture/Practice/Lab/Seminar/Other
    LessonPriority priority;// Low/Medium/High
    bool deleted;           // логическая пометка удаления
};
```
- AVL-дерево для строковых ключей: `StringTreeNodes[]` хранит `key` и `pos` исходной записи, баланс поддерживается поворотами.
- Отсортированные индексы:
  - `DateIdx[]` — целевой ключ `YYYYMMDDHHMM`, поиск бинарный с расширением на дубликаты слева/справа.
  - `IntIdx[]` — целочисленные ключи для `type`/`priority`.
- `CurrentIndexField` задаёт активное поле; меню позволяет выбрать и перестроить индекс.

## Назначение файлов
- `src/main.cpp` — точка входа, меню.
- `src/io.cpp` — ввод/вывод, работа с файлами, печать.
- `src/index.cpp` — построение индексов (AVL и массивы), вывод по индексу.
- `src/search.cpp` — поиск по текущему индексу (строка/дата+время/enum).
- `src/edit.cpp` — редактирование, логическое/физическое удаление, восстановление.
- `src/validation.cpp` — проверка даты/времени с детализированными ошибками.
- `src/types.cpp` — перечисления `LessonType`/`LessonPriority`, парсинг и форматирование.
- `src/messages.cpp` — все пользовательские строки и локаль.
- `src/data.cpp` — глобальные массивы и счётчики.
- `tests/tests.cpp`, `tests/gtest/gtest.h` — самодостаточные модульные тесты в стиле gtest (без внешних библиотек).
- `include/*.h` — заголовки для структур, перечислений, сообщений и API модулей.

## Формат текстового файла
```
title;teacher;date;time;room;type;priority;deleted_flag
```
`type` и `priority` читаются как текст (Lecture/Practice/Lab/Seminar/Other; Low/Medium/High) или числа (1–5, 1–3). `deleted_flag`: `1` — помечено как удалённое, `0` — активно.

## Сборка и запуск
### Linux/macOS (Makefile)
Требуется g++ с C++17.
```bash
cd SortTask
make         # приложение и тесты
make app     # только приложение
make tests   # только тесты
make clean   # убрать bin/, build/, *.gcov/coverage артефакты
```
Запуск:
```bash
cd SortTask
./bin/app
./bin/tests
```

### Visual Studio (MSVC)
Открыть `SortTask/SortTask.vcxproj`, убедиться в стандартe C++17 и пути `include/` в Additional Include Directories. Список исходников совпадает с каталогами `src/` и `include/`. Собрать Debug/Release и запустить консольное приложение.

## Покрытие кода
```bash
cd SortTask
make coverage   # собирает с --coverage, запускает тесты, генерирует coverage.html через gcovr
```
Если `gcovr` не установлен, цель подскажет об этом; отчёт создаётся в `coverage.html`.

## Краткое руководство пользователя
- Меню позволяет выбрать поле индекса (название/преподаватель/дата+время/аудитория/тип/приоритет), построить индекс, вывести по возрастанию/убыванию или выполнить поиск по текущему индексу
- При редактировании пустой ввод оставляет поле без изменений; неверные дата/время/тип/приоритет требуют повторного ввода
- Логическое удаление помечает запись; «физическое» удаляет все помеченные и сдвигает массив; восстановление ищет среди помеченных по выбранному полю.

## Ограничения и принятые решения
- Дубликаты ключей поддерживаются: поиск по индексу выводит все записи с совпадающим ключом в отсортированном порядке
