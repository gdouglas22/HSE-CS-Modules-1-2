# Самостоятельная работа 8–10
##### Национальный исследовательский универститет "Высшая школа экономики"

Состав команды:
- Фролов Б. В.
- а
- б
- в

## Структура
- `src/` — исходные файлы приложения
- `include/` — заголовки
- `tests/` — тесты
- `bin/` — исполняемые файлы после сборки
- `build/` — объектные файлы и зависимости после сборки
- `SortTask.vcxproj`/`SortTask.vcxproj.filters` — проект для Visual Studio
- `Makefile` — сборка под Linux и macOS

## Сборка под Linux/macOS (make)
Требуется `g++` с поддержкой C++17.
```bash
cd SortTask
make            # соберёт bin/app и bin/tests
make app        # только приложение
make tests      # только тесты
make clean      # очистка bin/ и build/
```

## Сборка в Visual Studio (MSVC)
- Открыть solution/project `SortTask/SortTask.vcxproj` в Visual Studio (Win32/x64).
- В свойствах проекта C/C++ включён стандарт C++17 и путь `include` в Additional Include Directories.
- Список исходников в проекте соответствует каталогу `src/`, заголовков — `include/`.
- Собрать конфигурацию Debug/Release, запустить полученный консольный exe.

## Запуск
```bash
cd SortTask
./bin/app    # основное приложение
./bin/tests  # модульные тесты
```

### Покрытие (gcov)
```bash
cd SortTask
make coverage   # собирает тесты с --coverage, запускает их и генерирует отчёт gcov
# создаст coverage.html (требуется установленный gcovr)
```
Цель `coverage` выполняет:
1. `make clean`
2. Сборку тестов с флагами `--coverage`
3. Запуск `./bin/tests`
4. Генерацию HTML-отчёта `coverage.html` с помощью `gcovr` (если установлен). Если `gcovr` не найден, будет подсказка установить его.

## Формат данных
Текстовый файл с разделителем `;` в порядке полей:
```
title;teacher;date;time;room;type;priority;deleted_flag
```
`type` и `priority` хранятся как текстовые значения (Lecture, Practice, Lab, Seminar, Other; Low, Medium, High). `deleted_flag` — `1` или `0`.

## Покрытие требований (задание по индексации)
1. **Ввод с клавиатуры без сортировки.** Реализовано в `addLessonFromKeyboard()`: записи добавляются в массив `Lessons[]` по порядку ввода.
2. **Вывод на экран в порядке ввода.** `printAllLessons()` проходит массив последовательно и печатает построчно.
3. **Вывод в текстовый файл с режимами.** `saveToFile()` пишет в формате с `;` и поддерживает выбор нового файла или дозаписи (режим зависит от ввода пользователя).
4. **Ввод из текстового файла.** `loadFromFile()` читает тот же формат, валидирует дату/время и тип/приоритет, пропуская ошибочные строки.
5. **Индекс по атрибуту.** `buildTitleIndex()` строит индекс-массив `TitleIdx[]` по названию занятия, храня ключ и позицию исходной записи.
6. **Индекс по вычисленному полю.** `buildDateIndex()` формирует индекс `DateIdx[]` по вычисленному целочисленному ключу `YYYYMMDDHHMM` (`ComputeDateTimeKey`).
7. **Вывод по индексам (возр./убыв.).** `printByTitleIndex()` и `printByDateIndex()` печатают в порядке индексов, поддерживают направление.
8. **Бинарный поиск по индексам.** Рекурсивный поиск по названию (`FindTitleIndex`/`RecBinarySearchTitle`) и итерационный по дате/времени (`IterBinarySearchDate`); при отсутствии элемента выводится сообщение.
9. **Редактирование с обновлением индексов.** `editLesson()` меняет атрибуты (включая индексируемые) и пересобирает индексы.
10. **Логическое/физическое удаление и восстановление.** `logicalDeleteLesson()` помечает запись, `physicalDeleteMarked()` удаляет помеченные, `restoreDeletedLesson()` снимает пометку.

## Структуры данных и индексы
- Основной массив: `Lesson Lessons[MAX_LESSONS]`, поля: `title`, `teacher`, `date`, `time`, `room`, `type` (`enum LessonType`), `priority` (`enum LessonPriority`), `deleted`.
- Индекс по названию: `TitleIndex TitleIdx[MAX_LESSONS]` с `key` (строка названия) и `pos` (индекс в `Lessons`). Строится выбором, хранит только не удалённые записи.
- Индекс по дате/времени: `DateTimeIndex DateIdx[MAX_LESSONS]` с `key` (числовой `YYYYMMDDHHMM`) и `pos`. Строится вставками, хранит только не удалённые записи.
- Поиск: бинарный поиск по отсортированным индексам (рекурсивный для названия, итерационный для даты/времени).
- Логика фильтрует удалённые записи при построении индексов, чтобы вывод/поиск шли по актуальным данным.

### Структура записи `Lesson`
```cpp
struct Lesson {
    std::string title;      // название занятия
    std::string teacher;    // ФИО преподавателя
    std::string date;       // дата в формате DD.MM.YYYY
    std::string time;       // время в формате HH:MM
    std::string room;       // аудитория
    LessonType type;        // перечисление: Lecture, Practice, Lab, Seminar, Other
    LessonPriority priority;// перечисление: Low, Medium, High
    bool deleted;           // логическая пометка удаления
};
```

## Назначение файлов
- `src/main.cpp` — точка входа консольного приложения, меню.
- `src/io.cpp` — ввод/вывод записей, сохранение/загрузка файлов, печать записей.
- `src/index.cpp` — построение и вывод индексов по названию и дате/времени.
- `src/search.cpp` — бинарные поиски по индексам (рекурсивный и итерационный).
- `src/edit.cpp` — редактирование, логическое удаление, восстановление, физическое удаление.
- `src/data.cpp` — глобальные массивы данных и счётчики.
- `src/messages.cpp` — таблицы сообщений/строк меню.
- `src/validation.cpp` — валидация даты/времени с детализацией ошибок.
- `src/types.cpp` — перечисления типа занятия/приоритета, парсинг/форматирование.
- `tests/tests.cpp` — модульные тесты логики.
- `tests/gtest/gtest.h` — лёгкий встроенный каркас в стиле Google Test (без внешней зависимости).

### Заголовки
- `include/lesson.h` — структура `Lesson`, индексы, глобальные массивы, объявления функций.
- `include/messages.h` — структура строк меню выбора опций и функции доступа к ним.
- `include/validation.h` — валидация даты/времени и статусов.
- `include/types.h` — перечисления `LessonType`/`LessonPriority` и функции парсинга/форматирования.

### Перечисления
- `LessonType` (Lecture, Practice, Lab, Seminar, Other) — фиксированный набор типов занятий, хранится как число для быстрых сравнений и сортировки, ввод/вывод через предопределённые опции.
- `LessonPriority` (Low, Medium, High) — фиксированный набор приоритетов, хранится как число для сопоставимых сравнений и исключения произвольных строк.
